var TmsmAquosSpaBookingApp=TmsmAquosSpaBookingApp||{};!function(e){"use strict";var t={url:TmsmAquosSpaBookingApp.ajaxurl,action:"tmsm-aquos-spa-booking-product-categories",sync:function(e,t,o){return void 0===o.data&&(o.data={}),o.data.nonce=TmsmAquosSpaBookingApp.nonce,o.data.action_type=e,void 0===o.data.action&&void 0!==this.action&&(o.data.action=this.action),Backbone.sync(e,t,o)}},o=Backbone.Model.extend(_.defaults({},t)),s=Backbone.Collection.extend(_.defaults({},t));TmsmAquosSpaBookingApp.HavevoucherModel=Backbone.Model.extend({defaults:{name:null,slug:null,value:null}}),TmsmAquosSpaBookingApp.HavevoucherCollection=Backbone.Collection.extend({model:TmsmAquosSpaBookingApp.HavevoucherModel}),TmsmAquosSpaBookingApp.HavevoucherListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-voucher-container",selectedValue:null,initialize:function(){console.log("HavevoucherListView initialize"),this.listenTo(this.collection,"sync",this.render),this.render()},render:function(){console.log("HavevoucherListView render");var t=e("ul#tmsm-aquos-spa-booking-voucher-list").empty(),o=new TmsmAquosSpaBookingApp.HavevoucherCollection;return o.add([TmsmAquosSpaBookingApp.data.havevoucher.yes,TmsmAquosSpaBookingApp.data.havevoucher.no]),o.each(function(e){var o=new TmsmAquosSpaBookingApp.HavevoucherListItemView({model:e});t.append(o.render().$el)},this),this},reset:function(e){this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.selectedValue=null},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.HavevoucherListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-havevoucher-item",template:wp.template("tmsm-aquos-spa-booking-havevoucher"),initialize:function(){this.selectedValue=null,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},select:function(t){TmsmAquosSpaBookingApp.havevoucherList.selectedValue=e(t.target).val(),TmsmAquosSpaBookingApp.messageForPriceAugmentation(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("is_voucher",TmsmAquosSpaBookingApp.havevoucherList.selectedValue),TmsmAquosSpaBookingApp.productsList.loading(),TmsmAquosSpaBookingApp.products.fetch({data:{is_voucher:TmsmAquosSpaBookingApp.havevoucherList.selectedValue}}),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productsList.element()),e("#tmsm-aquos-spa-booking-cancel").show()}}),TmsmAquosSpaBookingApp.ProductCategoryModel=o.extend({action:"tmsm-aquos-spa-booking-product-categories",defaults:{name:null,parent:null,count:null,term_id:null}}),TmsmAquosSpaBookingApp.ProductCategoriesCollection=s.extend({action:"tmsm-aquos-spa-booking-product-categories",model:TmsmAquosSpaBookingApp.ProductCategoryModel}),TmsmAquosSpaBookingApp.ProductCategoriesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-categories-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-categories-select",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var e=this.$(this.selectElement).empty().val("");return"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this.collection.each(function(t){var o=new TmsmAquosSpaBookingApp.ProductCategoriesListItemView({model:t});e.append(o.render().$el)},this),"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this},change:function(t){TmsmAquosSpaBookingApp.productsList.loading(),this.selectedValue=e(t.target).val(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.products.fetch({data:{productcategory:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("productcategory",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productsList.element())},reset:function(){this.$(this.selectElement).val("").selectpicker("refresh"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productcategory",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductCategoriesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("term_id")}},className:"tmsm-aquos-spa-booking-product-category-option",template:wp.template("tmsm-aquos-spa-booking-product-category"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},change:function(){}}),TmsmAquosSpaBookingApp.ProductModel=o.extend({action:"tmsm-aquos-spa-booking-products",defaults:{id:null,permalink:null,name:null,thumbnail:null,variable:null,attrotherthan_voucher:null,voucher_variation_id:null,choices:null,is_voucher:null,price:null,category:null}}),TmsmAquosSpaBookingApp.ProductsCollection=s.extend({action:"tmsm-aquos-spa-booking-products",model:TmsmAquosSpaBookingApp.ProductModel}),TmsmAquosSpaBookingApp.ProductsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-products-container",selectedValue:null,selectedIsVariable:null,selectedHasChoicesVariable:null,selectElement:"#tmsm-aquos-spa-booking-products-select",loadingElement:"#tmsm-aquos-spa-booking-products-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-products-select]",initialize:function(){this.hide(),console.log("ProductsListView initialize"),e(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){e(this.loadingElement).show(),e(this.buttonElement).hide(),e(this.selectElement).hide()},loaded:function(){e(this.loadingElement).hide(),e(this.buttonElement).show(),e(this.selectElement).show()},render:function(){var t=this.$(this.selectElement).empty().val("");t.hide(),"function"==typeof t.selectpicker&&(e.fn.selectpicker.Constructor.DEFAULTS.liveSearchPlaceholder=TmsmAquosSpaBookingApp.strings.livesearchplaceholder,t.selectpicker("refresh"));var o=[];if(this.collection.each(function(s){s.attributes.category&&!o[s.attributes.category]&&(o[s.attributes.category]=e("<optgroup>",{label:s.attributes.category}),t.append(o[s.attributes.category])),s.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;var i=new TmsmAquosSpaBookingApp.ProductsListItemView({model:s});o[s.attributes.category]&&o[s.attributes.category].append(i.render().$el)},this),e.each(o,function(e,s){t.append(o[e])}),"function"==typeof t.selectpicker&&(console.log("ProductsListView selectpicker refresh"),t.selectpicker("refresh"),null!=TmsmAquosSpaBookingApp.havevoucherList.selectedValue&&""!=TmsmAquosSpaBookingApp.productIdFromUrl)){console.log("Doing product preselection");var s=e("#tmsm-aquos-spa-booking-products-select option[data-parent_id="+TmsmAquosSpaBookingApp.productIdFromUrl+"]");if(s.length>0)console.log("found parent "+s.val()),TmsmAquosSpaBookingApp.productIdFromUrl=s.val();else{var i=e("#tmsm-aquos-spa-booking-products-select option[value="+TmsmAquosSpaBookingApp.productIdFromUrl+"]");i.length>0?console.log("found value "+i.val()):(console.log("did not found value"),TmsmAquosSpaBookingApp.productIdFromUrl=null)}console.log("TmsmAquosSpaBookingApp.productIdFromUrl:"+TmsmAquosSpaBookingApp.productIdFromUrl),e("#tmsm-aquos-spa-booking-products-select").val(TmsmAquosSpaBookingApp.productIdFromUrl).trigger("change")}return this.loaded(),null!=TmsmAquosSpaBookingApp.havevoucherList.selectedValue&&""!=TmsmAquosSpaBookingApp.productIdFromUrl&&e("#tmsm-aquos-spa-booking-products-select").val(TmsmAquosSpaBookingApp.productIdFromUrl),this},change:function(t){console.log("ProductListView change"),this.selectedValue=e(t.target).val(),e(t.target).find("option[value="+this.selectedValue+"]").prop("selected",!0),console.log(e(t.target).find("option[value="+this.selectedValue+"]")),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.loading(),console.log("selectedValue: "+this.selectedValue),console.log(e(t.target)),this.selectedIsVariable=e(t.target).find("option:selected").attr("data-variable"),this.selectedHasAttributesOtherthanVoucher=e(t.target).find("option:selected").attr("data-attrotherthanvoucher"),this.voucher_variation_id=e(t.target).find("option:selected").attr("data-voucher_variation_id"),console.log("selectedIsVariable: "+this.selectedIsVariable),console.log("selectedHasAttributesOtherthanVoucher: "+this.selectedHasAttributesOtherthanVoucher);var o=JSON.parse(e(t.target).find("option:selected").attr("data-choices"));this.selectedHasChoices=0!==o.length,console.warn("selectedChoices: "),TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("selectedHasAttributesOtherthanVoucher",this.selectedHasAttributesOtherthanVoucher),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.choicesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),this.selectedHasChoices?(console.warn("CASE 1"),TmsmAquosSpaBookingApp.data.choices=o,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.choicesList.element())):this.selectedIsVariable&&this.selectedHasAttributesOtherthanVoucher?(console.warn("CASE 2"),TmsmAquosSpaBookingApp.productvariations.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productattributes.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productAttributesList.element())):(console.warn("CASE 3"),TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.voucher_variation_id),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),null!==this.voucher_variation_id&&(TmsmAquosSpaBookingApp.selectedData.set("product",null),TmsmAquosSpaBookingApp.selectedData.set("product",this.voucher_variation_id),TmsmAquosSpaBookingApp.selectedData.set("productvariation",null),TmsmAquosSpaBookingApp.selectedData.unset("productvariation"))),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("product",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-parent_id":this.model.get("parent_id"),"data-subtext":this.model.get("sku"),"data-category":this.model.get("category"),"data-variable":this.model.get("variable"),"data-attrotherthanvoucher":this.model.get("attrotherthanvoucher"),"data-voucher_variation_id":this.model.get("voucher_variation_id"),"data-choices":this.model.get("choices")}},className:"tmsm-aquos-spa-booking-product-option",template:wp.template("tmsm-aquos-spa-booking-product"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.AttributeModel=o.extend({action:"tmsm-aquos-spa-booking-attributes",defaults:{label:null,description:null,is_voucher:null}}),TmsmAquosSpaBookingApp.AttributesCollection=s.extend({action:"tmsm-aquos-spa-booking-attributes",model:TmsmAquosSpaBookingApp.AttributeModel}),TmsmAquosSpaBookingApp.AttributesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,loadingElement:"#tmsm-aquos-spa-booking-attributes-loading",cancelElement:"#tmsm-aquos-spa-booking-attributes-cancel",confirmElement:"#tmsm-aquos-spa-booking-attributes-confirm",emptyElement:"#tmsm-aquos-spa-booking-attributes-empty",listElement:"#tmsm-aquos-spa-booking-attributes-list",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click #tmsm-aquos-spa-booking-attributes-cancel":"cancel","click #tmsm-aquos-spa-booking-attributes-confirm":"confirm"},loading:function(){e(this.emptyElement).hide(),e(this.loadingElement).show(),e(this.cancelElement).hide(),e(this.confirmElement).hide(),e(this.listElement).hide()},loaded:function(){e(this.loadingElement).hide(),e(this.cancelElement).show(),e(this.confirmElement).show(),e(this.listElement).show(),void 0!==TmsmAquosSpaBookingApp.productVariationsList&&(TmsmAquosSpaBookingApp.productVariationsList.matchattributes()?e(this.emptyElement).hide():(e(this.emptyElement).show(),e(this.cancelElement).hide(),e(this.confirmElement).hide(),e(this.listElement).hide()))},render:function(){e(this.loadingElement).show();var t=this.$(this.listElement).empty();return this.collection.each(function(e){e.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;var o=new TmsmAquosSpaBookingApp.AttributesListItemView({model:e});t.append(o.render().$el)},this),this.loaded(),this},cancel:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null},reset:function(e){TmsmAquosSpaBookingApp.courseParticipants=0,this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null,this.hide()},confirm:function(e){TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},checkattributes:function(){var t=e(".tmsm-aquos-spa-booking-attribute"),o=(e(".tmsm-aquos-spa-booking-term"),{}),s=0,i=0;if(t.length,0==TmsmAquosSpaBookingApp.productVariationsList.variationsCount)return!1;t.each(function(){var t=e(this).find("input[type=radio]"),a=t.data("attribute_name")||t.attr("name"),n=t.filter(":checked").val()||"";n.length>0&&i++,s++,o[a]=n});var a={count:s,chosenCount:i,data:o}.data;return t.each(function(t,o){var s=e(o).find("input[type=radio]"),i=s.data("attribute_name")||s.attr("name");e.extend(!0,{},a)[i]=""}),a},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.AttributesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-attribute",template:wp.template("tmsm-aquos-spa-booking-product-attribute"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},select:function(t){TmsmAquosSpaBookingApp.courseParticipants=0,e.inArray(e(t.target).val(),["avec-parcours-aquatonic","pa1","avec-parcours-aquatonic-1-personne"])&&(TmsmAquosSpaBookingApp.courseParticipants=1),e.inArray(e(t.target).val(),["pa2","avec-parcours-aquatonic-2-personnes"])&&(TmsmAquosSpaBookingApp.courseParticipants=2),console.info(" TmsmAquosSpaBookingApp.courseParticipants: "+TmsmAquosSpaBookingApp.courseParticipants),TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),TmsmAquosSpaBookingApp.productVariationsList.matchattributes()},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.ProductVariationModel=o.extend({action:"tmsm-aquos-spa-booking-variations",defaults:{id:null,permalink:null,name:null,thumbnail:null,sku:null,attributes:null,price:null,is_voucher:null}}),TmsmAquosSpaBookingApp.ProductVariationsCollection=s.extend({action:"tmsm-aquos-spa-booking-variations",model:TmsmAquosSpaBookingApp.ProductVariationModel}),TmsmAquosSpaBookingApp.ProductVariationsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-variations-select",variationsCount:0,buttonElement:"[data-id=tmsm-aquos-spa-booking-variations-select]",initialize:function(){e(this.emptyElement).hide(),e(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var e=this.$(this.selectElement).empty().val("");return e.hide(),"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this.collection.each(function(t){t.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;var o=new TmsmAquosSpaBookingApp.ProductVariationsListItemView({model:t});e.append(o.render().$el)},this),"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this.variationsCount=this.collection.length,TmsmAquosSpaBookingApp.productAttributesList.loading(),TmsmAquosSpaBookingApp.productAttributesList.render(),this},change:function(t){this.selectedValue=e(t.target).val(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.selectedValue)},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productvariation",null),TmsmAquosSpaBookingApp.selectedData.unset("productvariation"),this.hide()},matchattributes:function(){var t=TmsmAquosSpaBookingApp.productAttributesList.checkattributes();if(t){for(var o=this.collection.models,s=0;s<o.length;s++){var i=JSON.parse(o[s].attributes.attributes),a=!0;for(var n in i)if(i.hasOwnProperty(n)){var p=i[n],m=t[n];void 0!==p&&void 0!==m&&0!==p.length&&0!==m.length&&p!==m&&(a=!1)}!0===a&&e(this.selectElement).selectpicker("val",o[s].id).trigger("change")}return o}return!1},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductVariationsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-attributes":this.model.get("attributes")}},className:"tmsm-aquos-spa-booking-variation-option",template:wp.template("tmsm-aquos-spa-booking-variation"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.ChoiceModel=o.extend({action:"tmsm-aquos-spa-booking-choices",defaults:{aquos_id:null,name:null}}),TmsmAquosSpaBookingApp.ChoicesCollection=s.extend({action:"tmsm-aquos-spa-booking-choices",model:TmsmAquosSpaBookingApp.ChoiceModel}),TmsmAquosSpaBookingApp.ChoicesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-choices-container",selectedValue:null,selectedIsVariable:null,selectedHasAttributesOtherthanVoucher:null,selectElement:"#tmsm-aquos-spa-booking-choices-select",loadingElement:"#tmsm-aquos-spa-booking-choices-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-choices-select]",initialize:function(){this.hide(),e(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){e(this.loadingElement).show(),e(this.buttonElement).hide(),e(this.selectElement).hide()},loaded:function(){e(this.loadingElement).hide(),e(this.buttonElement).show(),e(this.selectElement).show()},render:function(){var e=this.$(this.selectElement).empty().val("");return e.hide(),"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this.collection.each(function(t){var o=new TmsmAquosSpaBookingApp.ChoicesListItemView({model:t});e.append(o.render().$el)},this),"function"==typeof e.selectpicker&&e.selectpicker("refresh"),this.loaded(),this},change:function(t){console.log("ChoicesListView change"),this.selectedValue=e(t.target).val(),console.log("selectedValue: "+this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("choice",this.selectedValue),console.log("TmsmAquosSpaBookingApp.selectedData.get('selectedHasAttributesOtherthanVoucher'):"+TmsmAquosSpaBookingApp.selectedData.get("selectedHasAttributesOtherthanVoucher")),console.log("this.selectedHasAttributesOtherthanVoucher:"+this.selectedHasAttributesOtherthanVoucher),TmsmAquosSpaBookingApp.selectedData.get("selectedHasAttributesOtherthanVoucher")?(console.warn("loading productAttributesList"),TmsmAquosSpaBookingApp.productvariations.fetch({data:{product:TmsmAquosSpaBookingApp.selectedData.get("product")}}),TmsmAquosSpaBookingApp.productattributes.fetch({data:{product:TmsmAquosSpaBookingApp.selectedData.get("product")}}),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productAttributesList.element())):(console.warn("loading dateList"),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render())},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("choice",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ChoicesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("aquos_id"),"data-aquosid":this.model.get("aquos_id")}},className:"tmsm-aquos-spa-booking-choice-option",template:wp.template("tmsm-aquos-spa-booking-choice"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.animateTransition=function(t){t.show(),e("html, body").animate({scrollTop:t.offset().top},400)},TmsmAquosSpaBookingApp.DateListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",selectedValue:null,datePicker:null,initialize:function(){this.hide(),this.render()},selectDate:function(t){console.warn("DateListView selectDate"),this.selectedValue=t.format("yyyy-mm-dd"),console.log("selectedValue: "+this.selectedValue);e("#tmsm-aquos-spa-booking-date-display").html(t.date.toLocaleDateString(TmsmAquosSpaBookingApp.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),TmsmAquosSpaBookingApp.timesList.loading(),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("date",this.selectedValue),TmsmAquosSpaBookingApp.weekdaysList&&"function"==typeof TmsmAquosSpaBookingApp.weekdaysList.showDate&&(console.warn("TmsmAquosSpaBookingApp.weekdaysList.showDate"),TmsmAquosSpaBookingApp.weekdaysList.showDate(this.selectedValue))},events:{},render:function(){return this.datePicker=e("#tmsm-aquos-spa-booking-datepicker").datepicker({language:TmsmAquosSpaBookingApp.locale,format:"yyyy-mm-dd",startDate:TmsmAquosSpaBookingApp.calendar.startdate,endDate:TmsmAquosSpaBookingApp.calendar.enddate}).on("changeDate",this.selectDate),this},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("date",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimeModel=o.extend({action:"tmsm-aquos-spa-booking-times",defaults:{date:null,hour:null,minute:null,priority:null,hourminutes:null}}),TmsmAquosSpaBookingApp.TimesCollection=s.extend({action:"tmsm-aquos-spa-booking-times",model:TmsmAquosSpaBookingApp.TimeModel}),TmsmAquosSpaBookingApp.TimesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-times-container",selectedValue:null,listElement:"#tmsm-aquos-spa-booking-times-list",loadingElement:"#tmsm-aquos-spa-booking-times-loading",errorElement:"#tmsm-aquos-spa-booking-times-error",anotherDateElement:"#tmsm-aquos-spa-booking-times-anotherdate",selectButtons:".tmsm-aquos-spa-booking-time-button",cancelButtons:".tmsm-aquos-spa-booking-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click .tmsm-aquos-spa-booking-time-change-label":"cancelTime","click #tmsm-aquos-spa-booking-times-anotherdate":"changeDate","click .previous":"previous","click .next":"next"},loading:function(){e(this.errorElement).hide(),e(this.loadingElement).show(),e(this.listElement).hide()},loaded:function(){e(this.loadingElement).hide(),e(this.listElement).show()},render:function(){var t=this.$(this.listElement).empty().val("");t.hide();var o=0;return this.collection.each(function(s){1===++o&&e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+s.attributes.date+'"]').empty();var i=new TmsmAquosSpaBookingApp.TimesListItemView({model:s});e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+s.attributes.date+'"]').length>0&&e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+s.attributes.date+'"]').append(i.render().el.outerHTML),t.append(i.render().$el)},this),this.loaded(),0===this.collection.length?e(this.errorElement).show():e(this.errorElement).hide(),this},selectTime:function(t){t.preventDefault(),this.selectedValue=e(t.target).data("hourminutes"),e(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),e(t.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquos-spa-booking-time").addClass("disabled"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue)},cancelTime:function(t){t.preventDefault(),e(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null)},changeDate:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element())},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-time-item",template:wp.template("tmsm-aquos-spa-booking-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.WeekDayModel=o.extend({action:"tmsm-aquos-spa-booking-weekday",defaults:{date_label:null,date_computed:null}}),TmsmAquosSpaBookingApp.WeekDayCollection=s.extend({action:"tmsm-aquos-spa-booking-weekday",model:TmsmAquosSpaBookingApp.WeekDayModel}),TmsmAquosSpaBookingApp.WeekDayListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",listElement:"#tmsm-aquos-spa-booking-weekdays-list",selectButtons:".tmsm-aquos-spa-booking-time-button",addAppointmentButton:"#tmsm-aquos-spa-booking-confirm",daysPage:1,templateHelpers:{moment:TmsmAquosSpaBookingApp.moment},initialize:function(){console.log("WeekDayListView initialize"),moment.locale(TmsmAquosSpaBookingApp.locale),console.log("moment",moment().format()),console.log("moment locale: "+moment.locale()),console.log("moment fromnow: "+moment().fromNow()),this.listenTo(this.collection,"sync",this.render),this.currentMonday=null},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click #tmsm-aquos-spa-booking-weekdays-previous":"previous","click #tmsm-aquos-spa-booking-weekdays-next":"next"},element:function(){return this.$el},previous:function(e){e.preventDefault(),this.currentMonday||(this.currentMonday=moment().isoWeekday(1)),this.currentMonday=this.currentMonday.clone().subtract(7,"days"),this.render()},next:function(e){e.preventDefault(),this.currentMonday||(this.currentMonday=moment().isoWeekday(1)),this.currentMonday=this.currentMonday.clone().add(7,"days"),this.render()},render:function(){var t=this.$(this.listElement).empty().val("");this.collection.reset();var o=TmsmAquosSpaBookingApp.selectedData&&TmsmAquosSpaBookingApp.selectedData.get&&TmsmAquosSpaBookingApp.selectedData.get("date");if(!this.currentMonday)if(o){var s=moment(o,"YYYY-MM-DD");this.currentMonday=s.clone().isoWeekday(1),7===s.isoWeekday()&&(this.currentMonday=s.clone().subtract(6,"days"))}else this.currentMonday=moment().isoWeekday(1);for(var i=0;i<7;i++){var a=this.currentMonday.clone().add(i,"days");this.collection.push({date_label:a.format("dddd Do MMMM"),date_label_secondline:a.format("MMMM"),date_label_firstline:a.format("dddd Do"),date_computed:a.format("YYYY-MM-DD")})}return e("#tmsm-aquos-spa-booking-weekdays-previous").attr("disabled",!1),e("#tmsm-aquos-spa-booking-weekdays-next").attr("disabled",!1),this.collection.each(function(o){var s=new TmsmAquosSpaBookingApp.WeekDayListItemView({model:o});t.append(s.render().$el),e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+o.attributes.date_computed+'"]').next().show(),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:o.attributes.date_computed},complete:function(t){console.log("complete fetch"),console.log('hide: .tmsm-aquos-spa-booking-weekday-times[data-date="'+o.attributes.date_computed+'"]'),e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+o.attributes.date_computed+'"]').next().hide(),console.log(e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+o.attributes.date_computed+'"]').next())}})},this),this},selectTime:function(t){t.preventDefault(),this.selectedValue=e(t.target).data("hourminutes");var o=e(t.target).data("date");e(this.selectButtons).removeClass("btn-primary").removeClass("disabled").removeClass("selected").addClass("not-selected"),e(t.target).addClass("btn-primary").addClass("disabled").removeClass("not-selected"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("date",o),TmsmAquosSpaBookingApp.selectedData.get("course_participants")>0&&TmsmAquosSpaBookingApp.courseplugin?TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.courseTimesList.element()):TmsmAquosSpaBookingApp.animateTransition(e(this.addAppointmentButton))},showDate:function(t){var o=moment(t,"YYYY-MM-DD"),s=o.clone().isoWeekday(1);7===o.isoWeekday()&&(s=o.clone().subtract(6,"days")),this.currentMonday=s,this.render(),setTimeout(function(){var o=e('.tmsm-aquos-spa-booking-weekday-item[data-date="'+t+'"]');o.length&&(o.addClass("highlighted"),e("html, body").animate({scrollTop:o.offset().top},400))},100)}}),TmsmAquosSpaBookingApp.WeekDayListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-weekday-item",template:wp.template("tmsm-aquos-spa-booking-weekday"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.CourseTimeModel=o.extend({action:"tmsm-aquos-spa-booking-course-times",defaults:{date:null,hour:null,minute:null,priority:null,hourminutes:null}}),TmsmAquosSpaBookingApp.CourseTimesCollection=s.extend({action:"tmsm-aquos-spa-booking-course-times",model:TmsmAquosSpaBookingApp.CourseTimeModel}),TmsmAquosSpaBookingApp.CourseTimesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-course-times-container",selectedValue:null,listElement:"#tmsm-aquos-spa-booking-course-times-list",loadingElement:"#tmsm-aquos-spa-booking-course-times-loading",errorElement:"#tmsm-aquos-spa-booking-course-times-error",anotherDateElement:"#tmsm-aquos-spa-booking-course-times-anotherdate",selectButtons:".tmsm-aquos-spa-booking-course-time-button",cancelButtons:".tmsm-aquos-spa-booking-course-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-course-time-button":"selectTime","click .tmsm-aquos-spa-booking-course-time-change-label":"cancelTime","click .previous":"previous","click .next":"next"},loading:function(){e(this.errorElement).hide(),e(this.loadingElement).show(),e(this.listElement).hide()},loaded:function(){e(this.loadingElement).hide(),e(this.listElement).show()},render:function(){var t=this.$(this.listElement).empty().val("");t.hide();var o=0;return this.collection.each(function(s){1===++o&&e('.tmsm-aquos-spa-booking-weekday-times[data-date="'+s.attributes.date+'"]').empty();var i=new TmsmAquosSpaBookingApp.TimesListItemView({model:s});t.append(i.render().$el)},this),this.loaded(),0===this.collection.length?e(this.errorElement).show():e(this.errorElement).hide(),this},selectTime:function(t){t.preventDefault(),this.selectedValue=e(t.target).data("hourminutes"),e(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),e(t.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquos-spa-booking-course-time").addClass("disabled"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue)},cancelTime:function(t){t.preventDefault(),e(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null)},changeDate:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.courseTimesList.reset()},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.CourseTimesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-course-time-item",template:wp.template("tmsm-aquos-spa-booking-course-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.SelectedDataModel=Backbone.Model.extend({defaults:{productcategory:null,product:null,productvariation:null,date:null,hourminutes:null,course_participants:null,course_hourminutes:null,is_voucher:null}}),TmsmAquosSpaBookingApp.SelectedDataView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-confirm-container",cancelButton:"#tmsm-aquos-spa-booking-cancel",confirmButton:"#tmsm-aquos-spa-booking-confirm",errorElement:"#tmsm-aquos-spa-booking-confirm-error",initialize:function(){this.hideError(),this.hideConfirm(),this.hideCancel(),this.listenTo(this.model,"change",this.change)},events:{"click #tmsm-aquos-spa-booking-cancel":"cancel","click #tmsm-aquos-spa-booking-confirm":"confirm"},cancel:function(e){e.preventDefault(),this.hideError(),TmsmAquosSpaBookingApp.selectedData.clear().set({}),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.havevoucherList.element()),TmsmAquosSpaBookingApp.havevoucherList.reset(),TmsmAquosSpaBookingApp.productCategoriesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset()},confirm:function(t){t.preventDefault(),console.log("SelectedDataView confirm"),e(this.errorElement).empty(),this.showLoading();var o=this;wp.ajax.send("tmsm-aquos-spa-booking-addtocart",{success:function(e){e.redirect?window.location=e.redirect:(console.log("no redirect..."),console.log(e.redirect))},error:function(t){t.errors&&(o.showError(),e(o.errorElement).html(t.errors))},data:{nonce:TmsmAquosSpaBookingApp.nonce,selecteddata:TmsmAquosSpaBookingApp.selectedData.attributes}})},change:function(){console.log("SelectedDataView change"),this.canConfirm(this.model.attributes)?this.showConfirm():this.hideConfirm(),this.canCancel(this.model.attributes)?this.showCancel():this.hideCancel()},showLoading:function(){e(this.confirmButton).prop("disabled",!0).addClass("btn-disabled")},hideLoading:function(){e(this.confirmButton).prop("disabled",!1).removeClass("btn-disabled")},showError:function(){e(this.errorElement).show()},hideError:function(){e(this.errorElement).hide()},showConfirm:function(){e(this.confirmButton).show()},hideConfirm:function(){e(this.confirmButton).hide()},showCancel:function(){e(this.cancelButton).show()},hideCancel:function(){e(this.cancelButton).hide()},canConfirm:function(e){return null!=e.productcategory&&null!=e.product&&null!=e.date&&null!=e.hourminutes},canCancel:function(e){return null!=e.is_voucher&&null!=e.productcategory},render:function(){return this},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.messageForPriceAugmentation=function(){let t=TmsmAquosSpaBookingApp.calendar.daysrangeto,o=TmsmAquosSpaBookingApp.calendar.messagedate,s=e(event.target).val(),i=new Date,a=(n=o,(n=new Date(n)).setDate(n.getDate()+1),n);var n;let p=Math.floor((a-i)/864e5);console.log(p),p<=t&&p>=0&&(0==s?e(".tmsm-message").show():e(".tmsm-message").hide())},TmsmAquosSpaBookingApp.init=function(){TmsmAquosSpaBookingApp.productIdFromUrl=window.location.hash.split("#").pop(),TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.havevoucherList=new TmsmAquosSpaBookingApp.HavevoucherListView,TmsmAquosSpaBookingApp.productcategories=new TmsmAquosSpaBookingApp.ProductCategoriesCollection,TmsmAquosSpaBookingApp.productcategories.reset(TmsmAquosSpaBookingApp.data.productcategories),TmsmAquosSpaBookingApp.productCategoriesList=new TmsmAquosSpaBookingApp.ProductCategoriesListView({collection:TmsmAquosSpaBookingApp.productcategories}),TmsmAquosSpaBookingApp.productCategoriesList.render(),TmsmAquosSpaBookingApp.productattributes=new TmsmAquosSpaBookingApp.AttributesCollection,TmsmAquosSpaBookingApp.productattributes.reset(TmsmAquosSpaBookingApp.data.productattributes),TmsmAquosSpaBookingApp.productAttributesList=new TmsmAquosSpaBookingApp.AttributesListView({collection:TmsmAquosSpaBookingApp.productattributes}),TmsmAquosSpaBookingApp.productAttributesList.render(),TmsmAquosSpaBookingApp.products=new TmsmAquosSpaBookingApp.ProductsCollection,TmsmAquosSpaBookingApp.products.reset(TmsmAquosSpaBookingApp.data.products),TmsmAquosSpaBookingApp.productsList=new TmsmAquosSpaBookingApp.ProductsListView({collection:TmsmAquosSpaBookingApp.products}),TmsmAquosSpaBookingApp.productsList.render(),TmsmAquosSpaBookingApp.productvariations=new TmsmAquosSpaBookingApp.ProductVariationsCollection,TmsmAquosSpaBookingApp.productvariations.reset(TmsmAquosSpaBookingApp.data.productvariations),TmsmAquosSpaBookingApp.productVariationsList=new TmsmAquosSpaBookingApp.ProductVariationsListView({collection:TmsmAquosSpaBookingApp.productvariations}),TmsmAquosSpaBookingApp.productVariationsList.render(),TmsmAquosSpaBookingApp.choices=new TmsmAquosSpaBookingApp.ChoicesCollection,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList=new TmsmAquosSpaBookingApp.ChoicesListView({collection:TmsmAquosSpaBookingApp.choices}),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.dateList=new TmsmAquosSpaBookingApp.DateListView,TmsmAquosSpaBookingApp.times=new TmsmAquosSpaBookingApp.TimesCollection,TmsmAquosSpaBookingApp.times.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.timesList=new TmsmAquosSpaBookingApp.TimesListView({collection:TmsmAquosSpaBookingApp.times}),TmsmAquosSpaBookingApp.timesList.render(),TmsmAquosSpaBookingApp.weekdays=new TmsmAquosSpaBookingApp.WeekDayCollection,TmsmAquosSpaBookingApp.weekdays.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.weekdaysList=new TmsmAquosSpaBookingApp.WeekDayListView({collection:TmsmAquosSpaBookingApp.weekdays}),TmsmAquosSpaBookingApp.weekdaysList.render(),TmsmAquosSpaBookingApp.coursetimes=new TmsmAquosSpaBookingApp.CourseTimesCollection,TmsmAquosSpaBookingApp.coursetimes.reset(TmsmAquosSpaBookingApp.data.coursetimes),TmsmAquosSpaBookingApp.courseTimesList=new TmsmAquosSpaBookingApp.CourseTimesListView({collection:TmsmAquosSpaBookingApp.coursetimes}),TmsmAquosSpaBookingApp.courseTimesList.render(),TmsmAquosSpaBookingApp.selectedData=new TmsmAquosSpaBookingApp.SelectedDataModel,TmsmAquosSpaBookingApp.selectedDataList=new TmsmAquosSpaBookingApp.SelectedDataView({model:TmsmAquosSpaBookingApp.selectedData})},e(document).ready(function(){e("#tmsm-aquos-spa-booking-form").length>0&&TmsmAquosSpaBookingApp.init()})}(jQuery),document.addEventListener("om.Scripts.init",function(e){window._omapp.scripts.moment.status="loaded",window._omapp.scripts.moment.object=window.moment?window.moment:null,window._omapp.scripts.momentTz.status="loaded",window._omapp.scripts.momentTz.object=window.moment?window.moment.tz:null});