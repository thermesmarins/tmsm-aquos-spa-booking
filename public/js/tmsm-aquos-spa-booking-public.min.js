var TmsmAquosSpaBookingApp=TmsmAquosSpaBookingApp||{};!function($){"use strict";var BaseCollection={url:TmsmAquosSpaBookingApp.ajaxurl,action:"tmsm-aquos-spa-booking-product-categories",sync:function(method,object,options){return void 0===options.data&&(options.data={}),options.data.nonce=TmsmAquosSpaBookingApp.nonce,options.data.action_type=method,void 0===options.data.action&&void 0!==this.action&&(options.data.action=this.action),Backbone.sync(method,object,options)}},BaseModel=Backbone.Model.extend(_.defaults({},BaseCollection)),BaseCollection=Backbone.Collection.extend(_.defaults({},BaseCollection));TmsmAquosSpaBookingApp.HavevoucherModel=Backbone.Model.extend({defaults:{name:null,slug:null,value:null}}),TmsmAquosSpaBookingApp.HavevoucherCollection=Backbone.Collection.extend({model:TmsmAquosSpaBookingApp.HavevoucherModel}),TmsmAquosSpaBookingApp.HavevoucherListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-voucher-container",selectedValue:null,initialize:function(){this.listenTo(this.collection,"sync",this.render),this.render()},render:function(){var $list=$("ul#tmsm-aquos-spa-booking-voucher-list").empty(),havevoucher=new TmsmAquosSpaBookingApp.HavevoucherCollection;return havevoucher.add([TmsmAquosSpaBookingApp.data.havevoucher.yes,TmsmAquosSpaBookingApp.data.havevoucher.no]),havevoucher.each(function(item){item=new TmsmAquosSpaBookingApp.HavevoucherListItemView({model:item});$list.append(item.render().$el)},this),this},reset:function(event){this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.selectedValue=null},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.HavevoucherListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-havevoucher-item",template:wp.template("tmsm-aquos-spa-booking-havevoucher"),initialize:function(){this.selectedValue=null,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this},select:function(event){TmsmAquosSpaBookingApp.havevoucherList.selectedValue=$(event.target).val(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("is_voucher",TmsmAquosSpaBookingApp.havevoucherList.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productCategoriesList.element()),$("#tmsm-aquos-spa-booking-cancel").show()}}),TmsmAquosSpaBookingApp.ProductCategoryModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-product-categories",defaults:{name:null,parent:null,count:null,term_id:null}}),TmsmAquosSpaBookingApp.ProductCategoriesCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-product-categories",model:TmsmAquosSpaBookingApp.ProductCategoryModel}),TmsmAquosSpaBookingApp.ProductCategoriesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-categories-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-categories-select",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var $list=this.$(this.selectElement).empty().val("");return"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.collection.each(function(item){item=new TmsmAquosSpaBookingApp.ProductCategoriesListItemView({model:item});$list.append(item.render().$el)},this),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this},change:function(event){TmsmAquosSpaBookingApp.productsList.loading(),this.selectedValue=$(event.target).val(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.products.fetch({data:{productcategory:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("productcategory",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productsList.element())},reset:function(){this.$(this.selectElement).val("").selectpicker("refresh"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productcategory",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductCategoriesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("term_id")}},className:"tmsm-aquos-spa-booking-product-category-option",template:wp.template("tmsm-aquos-spa-booking-product-category"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this},change:function(){}}),TmsmAquosSpaBookingApp.ProductModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-products",defaults:{id:null,permalink:null,name:null,thumbnail:null,variable:null,attributes_otherthan_voucher:null,choices:null,is_voucher:null,price:null}}),TmsmAquosSpaBookingApp.ProductsCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-products",model:TmsmAquosSpaBookingApp.ProductModel}),TmsmAquosSpaBookingApp.ProductsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-products-container",selectedValue:null,selectedIsVariable:null,selectedHasChoicesVariable:null,selectElement:"#tmsm-aquos-spa-booking-products-select",loadingElement:"#tmsm-aquos-spa-booking-products-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-products-select]",initialize:function(){this.hide(),$(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){$(this.loadingElement).show(),$(this.buttonElement).hide(),$(this.selectElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.buttonElement).show(),$(this.selectElement).show()},render:function(){var $list=this.$(this.selectElement).empty().val("");return $list.hide(),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.collection.each(function(item){item.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;item=new TmsmAquosSpaBookingApp.ProductsListItemView({model:item});$list.append(item.render().$el)},this),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.loaded(),this},change:function(choices){this.selectedValue=$(choices.target).val(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.loading(),this.selectedIsVariable=$(choices.target).children("option:selected").attr("data-variable"),this.selectedHasAttributesOtherthanVoucher=$(choices.target).children("option:selected").attr("data-attributes_otherthan_voucher");choices=JSON.parse($(choices.target).children("option:selected").attr("data-choices"));this.selectedHasChoices=0!==choices.length,TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.choicesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),this.selectedHasChoices?(TmsmAquosSpaBookingApp.data.choices=choices,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.choicesList.element())):this.selectedIsVariable&&this.selectedHasAttributesOtherthanVoucher?(TmsmAquosSpaBookingApp.productvariations.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productattributes.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productAttributesList.element())):(TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element())),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("product",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-variable":this.model.get("variable"),"data-attributes_otherthan_voucher":this.model.get("attributes_otherthan_voucher"),"data-choices":this.model.get("choices")}},className:"tmsm-aquos-spa-booking-product-option",template:wp.template("tmsm-aquos-spa-booking-product"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.AttributeModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-attributes",defaults:{label:null,description:null,is_voucher:null}}),TmsmAquosSpaBookingApp.AttributesCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-attributes",model:TmsmAquosSpaBookingApp.AttributeModel}),TmsmAquosSpaBookingApp.AttributesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,loadingElement:"#tmsm-aquos-spa-booking-attributes-loading",cancelElement:"#tmsm-aquos-spa-booking-attributes-cancel",confirmElement:"#tmsm-aquos-spa-booking-attributes-confirm",emptyElement:"#tmsm-aquos-spa-booking-attributes-empty",listElement:"#tmsm-aquos-spa-booking-attributes-list",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click #tmsm-aquos-spa-booking-attributes-cancel":"cancel","click #tmsm-aquos-spa-booking-attributes-confirm":"confirm"},loading:function(){$(this.emptyElement).hide(),$(this.loadingElement).show(),$(this.cancelElement).hide(),$(this.confirmElement).hide(),$(this.listElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.cancelElement).show(),$(this.confirmElement).show(),$(this.listElement).show(),void 0!==TmsmAquosSpaBookingApp.productVariationsList&&(TmsmAquosSpaBookingApp.productVariationsList.matchattributes()?$(this.emptyElement).hide():($(this.emptyElement).show(),$(this.cancelElement).hide(),$(this.confirmElement).hide(),$(this.listElement).hide()))},render:function(){$(this.loadingElement).show();var $list=this.$(this.listElement).empty();return this.collection.each(function(item){item.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;item=new TmsmAquosSpaBookingApp.AttributesListItemView({model:item});$list.append(item.render().$el)},this),this.loaded(),this},cancel:function(event){event.preventDefault(),TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null},reset:function(event){TmsmAquosSpaBookingApp.courseParticipants=0,this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null,this.hide()},confirm:function(event){TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},checkattributes:function(){var $attributeGroups=$(".tmsm-aquos-spa-booking-attribute"),data=($(".tmsm-aquos-spa-booking-term"),{}),count=0,chosen=0;if($attributeGroups.length,0==TmsmAquosSpaBookingApp.productVariationsList.variationsCount)return!1;$attributeGroups.each(function(){var value=$(this).find("input[type=radio]"),attribute_name=value.data("attribute_name")||value.attr("name"),value=value.filter(":checked").val()||"";0<value.length&&chosen++,count++,data[attribute_name]=value});var currentAttributes={count:count,chosenCount:chosen,data:data}.data;return $attributeGroups.each(function(index,current_attr_name){current_attr_name=$(current_attr_name).find("input[type=radio]"),current_attr_name=current_attr_name.data("attribute_name")||current_attr_name.attr("name");$.extend(!0,{},currentAttributes)[current_attr_name]=""}),currentAttributes},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.AttributesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-attribute",template:wp.template("tmsm-aquos-spa-booking-product-attribute"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},select:function(event){TmsmAquosSpaBookingApp.courseParticipants=0,$.inArray($(event.target).val(),["avec-parcours-aquatonic","pa1","avec-parcours-aquatonic-1-personne"])&&(TmsmAquosSpaBookingApp.courseParticipants=1),$.inArray($(event.target).val(),["pa2","avec-parcours-aquatonic-2-personnes"])&&(TmsmAquosSpaBookingApp.courseParticipants=2),TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),TmsmAquosSpaBookingApp.productVariationsList.matchattributes()},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.ProductVariationModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-variations",defaults:{id:null,permalink:null,name:null,thumbnail:null,sku:null,attributes:null,price:null,is_voucher:null}}),TmsmAquosSpaBookingApp.ProductVariationsCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-variations",model:TmsmAquosSpaBookingApp.ProductVariationModel}),TmsmAquosSpaBookingApp.ProductVariationsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-variations-select",variationsCount:0,buttonElement:"[data-id=tmsm-aquos-spa-booking-variations-select]",initialize:function(){$(this.emptyElement).hide(),$(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var $list=this.$(this.selectElement).empty().val("");return $list.hide(),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.collection.each(function(item){item.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;item=new TmsmAquosSpaBookingApp.ProductVariationsListItemView({model:item});$list.append(item.render().$el)},this),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.variationsCount=this.collection.length,TmsmAquosSpaBookingApp.productAttributesList.loading(),TmsmAquosSpaBookingApp.productAttributesList.render(),this},change:function(event){this.selectedValue=$(event.target).val(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.selectedValue)},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productvariation",null),this.hide()},matchattributes:function(){var checkAttributes=TmsmAquosSpaBookingApp.productAttributesList.checkattributes();if(checkAttributes){for(var variations=this.collection.models,i=0;i<variations.length;i++){var attr_name,val1,val2,variation_attributes=JSON.parse(variations[i].attributes.attributes),match=!0;for(attr_name in variation_attributes){variation_attributes.hasOwnProperty(attr_name)&&(val1=variation_attributes[attr_name],val2=checkAttributes[attr_name],void 0!==val1&&void 0!==val2&&0!==val1.length&&0!==val2.length&&val1!==val2&&(match=!1))}!0===match&&$(this.selectElement).selectpicker("val",variations[i].id).trigger("change")}return variations}return!1},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductVariationsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-attributes":this.model.get("attributes")}},className:"tmsm-aquos-spa-booking-variation-option",template:wp.template("tmsm-aquos-spa-booking-variation"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.ChoiceModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-choices",defaults:{aquos_id:null,name:null}}),TmsmAquosSpaBookingApp.ChoicesCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-choices",model:TmsmAquosSpaBookingApp.ChoiceModel}),TmsmAquosSpaBookingApp.ChoicesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-choices-container",selectedValue:null,selectedIsVariable:null,selectedHasAttributesOtherthanVoucher:null,selectElement:"#tmsm-aquos-spa-booking-choices-select",loadingElement:"#tmsm-aquos-spa-booking-choices-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-choices-select]",initialize:function(){this.hide(),$(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){$(this.loadingElement).show(),$(this.buttonElement).hide(),$(this.selectElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.buttonElement).show(),$(this.selectElement).show()},render:function(){var $list=this.$(this.selectElement).empty().val("");return $list.hide(),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.collection.each(function(item){item=new TmsmAquosSpaBookingApp.ChoicesListItemView({model:item});$list.append(item.render().$el)},this),"function"==typeof $list.selectpicker&&$list.selectpicker("refresh"),this.loaded(),this},change:function(event){this.selectedValue=$(event.target).val(),TmsmAquosSpaBookingApp.selectedData.set("choice",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("choice",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ChoicesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("aquos_id"),"data-aquosid":this.model.get("aquos_id")}},className:"tmsm-aquos-spa-booking-choice-option",template:wp.template("tmsm-aquos-spa-booking-choice"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.animateTransition=function(element){element.show(),$("html, body").animate({scrollTop:element.offset().top},400)},TmsmAquosSpaBookingApp.DateListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",selectedValue:null,datePicker:null,initialize:function(){this.hide(),this.render()},selectDate:function(date){this.selectedValue=date.format("yyyy-mm-dd");$("#tmsm-aquos-spa-booking-date-display").html(date.date.toLocaleDateString(TmsmAquosSpaBookingApp.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),TmsmAquosSpaBookingApp.timesList.loading(),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("date",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.timesList.element())},events:{},render:function(){return this.datePicker=$("#tmsm-aquos-spa-booking-datepicker").datepicker({language:TmsmAquosSpaBookingApp.locale,format:"yyyy-mm-dd",startDate:TmsmAquosSpaBookingApp.calendar.startdate,endDate:TmsmAquosSpaBookingApp.calendar.enddate}).on("changeDate",this.selectDate),this},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("date",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimeModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-times",defaults:{date:null,hour:null,minute:null,priority:null,hourminutes:null}}),TmsmAquosSpaBookingApp.TimesCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-times",model:TmsmAquosSpaBookingApp.TimeModel}),TmsmAquosSpaBookingApp.TimesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-times-container",selectedValue:null,listElement:"#tmsm-aquos-spa-booking-times-list",loadingElement:"#tmsm-aquos-spa-booking-times-loading",errorElement:"#tmsm-aquos-spa-booking-times-error",anotherDateElement:"#tmsm-aquos-spa-booking-times-anotherdate",selectButtons:".tmsm-aquos-spa-booking-time-button",cancelButtons:".tmsm-aquos-spa-booking-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click .tmsm-aquos-spa-booking-time-change-label":"cancelTime","click #tmsm-aquos-spa-booking-times-anotherdate":"changeDate","click .previous":"previous","click .next":"next"},loading:function(){$(this.errorElement).hide(),$(this.loadingElement).show(),$(this.listElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.listElement).show()},render:function(){var $list=this.$(this.listElement).empty().val("");$list.hide();var i=0;return this.collection.each(function(model){1===++i&&$('.tmsm-aquos-spa-booking-weekday-times[data-date="'+model.attributes.date+'"]').empty();var item=new TmsmAquosSpaBookingApp.TimesListItemView({model:model});0<$('.tmsm-aquos-spa-booking-weekday-times[data-date="'+model.attributes.date+'"]').length&&$('.tmsm-aquos-spa-booking-weekday-times[data-date="'+model.attributes.date+'"]').append(item.render().$el.context.outerHTML),$list.append(item.render().$el)},this),this.loaded(),0===this.collection.length?$(this.errorElement).show():$(this.errorElement).hide(),this},selectTime:function(event){event.preventDefault(),this.selectedValue=$(event.target).data("hourminutes"),$(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),$(event.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquos-spa-booking-time").addClass("disabled"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue)},cancelTime:function(event){event.preventDefault(),$(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null)},changeDate:function(event){event.preventDefault(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element())},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-time-item",template:wp.template("tmsm-aquos-spa-booking-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.WeekDayModel=BaseModel.extend({action:"tmsm-aquos-spa-booking-weekday",defaults:{date_label:null,date_computed:null}}),TmsmAquosSpaBookingApp.WeekDayCollection=BaseCollection.extend({action:"tmsm-aquos-spa-booking-weekday",model:TmsmAquosSpaBookingApp.WeekDayModel}),TmsmAquosSpaBookingApp.WeekDayListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",listElement:"#tmsm-aquos-spa-booking-weekdays-list",selectButtons:".tmsm-aquos-spa-booking-time-button",addAppointmentButton:"#tmsm-aquos-spa-booking-confirm",daysPage:1,templateHelpers:{moment:moment},initialize:function(){moment.locale(TmsmAquosSpaBookingApp.locale),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click #tmsm-aquos-spa-booking-weekdays-previous":"previous","click #tmsm-aquos-spa-booking-weekdays-next":"next"},previous:function(event){event.preventDefault(),this.daysPage=this.daysPage-1,this.render()},next:function(event){event.preventDefault(),this.daysPage=this.daysPage+1,this.render()},render:function(){var $list=this.$(this.listElement).empty().val("");this.collection.reset(),1===this.daysPage?$("#tmsm-aquos-spa-booking-weekdays-previous").attr("disabled",!0):$("#tmsm-aquos-spa-booking-weekdays-previous").attr("disabled",!1),TmsmAquosSpaBookingApp.calendar.daysrangeto/7<this.daysPage?$("#tmsm-aquos-spa-booking-weekdays-next").attr("disabled",!0):$("#tmsm-aquos-spa-booking-weekdays-next").attr("disabled",!1);var i=0;if(TmsmAquosSpaBookingApp.productsList.selectedValue){for(i=parseInt(TmsmAquosSpaBookingApp.calendar.daysrangefrom)+7*(this.daysPage-1);i<parseInt(TmsmAquosSpaBookingApp.calendar.daysrangefrom)+7+7*(this.daysPage-1);i++)this.collection.push({date_label:moment().add(i,"days").format("dddd Do MMMM"),date_label_secondline:moment().add(i,"days").format("MMMM"),date_label_firstline:moment().add(i,"days").format("dddd Do"),date_computed:moment().add(i,"days").format("YYYY-MM-DD")});this.collection.each(function(model){var item=new TmsmAquosSpaBookingApp.WeekDayListItemView({model:model});$list.append(item.render().$el),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:model.attributes.date_computed}})},this)}return this},selectTime:function(event){event.preventDefault(),this.selectedValue=$(event.target).data("hourminutes");var date=$(event.target).data("date");$(this.selectButtons).removeClass("btn-primary").removeClass("disabled").removeClass("selected").addClass("not-selected"),$(event.target).addClass("btn-primary").addClass("disabled").removeClass("not-selected"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("date",date),0<TmsmAquosSpaBookingApp.selectedData.get("course_participants")&&TmsmAquosSpaBookingApp.courseplugin||TmsmAquosSpaBookingApp.animateTransition($(this.addAppointmentButton))}}),TmsmAquosSpaBookingApp.WeekDayListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-weekday-item",template:wp.template("tmsm-aquos-spa-booking-weekday"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquosSpaBookingApp.SelectedDataModel=Backbone.Model.extend({defaults:{productcategory:null,product:null,productvariation:null,date:null,hourminutes:null,course_participants:null,course_hourminutes:null,is_voucher:null}}),TmsmAquosSpaBookingApp.SelectedDataView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-confirm-container",cancelButton:"#tmsm-aquos-spa-booking-cancel",confirmButton:"#tmsm-aquos-spa-booking-confirm",errorElement:"#tmsm-aquos-spa-booking-confirm-error",initialize:function(){this.hideError(),this.hideConfirm(),this.hideCancel(),this.listenTo(this.model,"change",this.change)},events:{"click #tmsm-aquos-spa-booking-cancel":"cancel","click #tmsm-aquos-spa-booking-confirm":"confirm"},cancel:function(event){event.preventDefault(),this.hideError(),TmsmAquosSpaBookingApp.selectedData.clear().set({}),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.havevoucherList.element()),TmsmAquosSpaBookingApp.havevoucherList.reset(),TmsmAquosSpaBookingApp.productCategoriesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset()},confirm:function(event){event.preventDefault(),$(this.errorElement).empty(),this.showLoading();var container=this;wp.ajax.send("tmsm-aquos-spa-booking-addtocart",{success:function(data){data.redirect&&(window.location=data.redirect)},error:function(data){container.hideLoading(),data.errors&&(container.showError(),$(container.errorElement).html(data.errors))},data:{nonce:TmsmAquosSpaBookingApp.nonce,selecteddata:TmsmAquosSpaBookingApp.selectedData.attributes}})},change:function(){this.canConfirm(this.model.attributes)?this.showConfirm():this.hideConfirm(),this.canCancel(this.model.attributes)?this.showCancel():this.hideCancel()},showLoading:function(){$(this.confirmButton).prop("disabled",!0).addClass("btn-disabled")},hideLoading:function(){$(this.confirmButton).prop("disabled",!1).removeClass("btn-disabled")},showError:function(){$(this.errorElement).show()},hideError:function(){$(this.errorElement).hide()},showConfirm:function(){$(this.confirmButton).show()},hideConfirm:function(){$(this.confirmButton).hide()},showCancel:function(){$(this.cancelButton).show()},hideCancel:function(){$(this.cancelButton).hide()},canConfirm:function(attributes){return null!=attributes.productcategory&&null!=attributes.product&&null!=attributes.date&&null!=attributes.hourminutes},canCancel:function(attributes){return null!=attributes.is_voucher&&null!=attributes.productcategory},render:function(){return this},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.init=function(){TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.havevoucherList=new TmsmAquosSpaBookingApp.HavevoucherListView,TmsmAquosSpaBookingApp.productcategories=new TmsmAquosSpaBookingApp.ProductCategoriesCollection,TmsmAquosSpaBookingApp.productcategories.reset(TmsmAquosSpaBookingApp.data.productcategories),TmsmAquosSpaBookingApp.productCategoriesList=new TmsmAquosSpaBookingApp.ProductCategoriesListView({collection:TmsmAquosSpaBookingApp.productcategories}),TmsmAquosSpaBookingApp.productCategoriesList.render(),TmsmAquosSpaBookingApp.productattributes=new TmsmAquosSpaBookingApp.AttributesCollection,TmsmAquosSpaBookingApp.productattributes.reset(TmsmAquosSpaBookingApp.data.productattributes),TmsmAquosSpaBookingApp.productAttributesList=new TmsmAquosSpaBookingApp.AttributesListView({collection:TmsmAquosSpaBookingApp.productattributes}),TmsmAquosSpaBookingApp.productAttributesList.render(),TmsmAquosSpaBookingApp.products=new TmsmAquosSpaBookingApp.ProductsCollection,TmsmAquosSpaBookingApp.products.reset(TmsmAquosSpaBookingApp.data.products),TmsmAquosSpaBookingApp.productsList=new TmsmAquosSpaBookingApp.ProductsListView({collection:TmsmAquosSpaBookingApp.products}),TmsmAquosSpaBookingApp.productsList.render(),TmsmAquosSpaBookingApp.productvariations=new TmsmAquosSpaBookingApp.ProductVariationsCollection,TmsmAquosSpaBookingApp.productvariations.reset(TmsmAquosSpaBookingApp.data.productvariations),TmsmAquosSpaBookingApp.productVariationsList=new TmsmAquosSpaBookingApp.ProductVariationsListView({collection:TmsmAquosSpaBookingApp.productvariations}),TmsmAquosSpaBookingApp.productVariationsList.render(),TmsmAquosSpaBookingApp.choices=new TmsmAquosSpaBookingApp.ChoicesCollection,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList=new TmsmAquosSpaBookingApp.ChoicesListView({collection:TmsmAquosSpaBookingApp.choices}),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.dateList=new TmsmAquosSpaBookingApp.DateListView,TmsmAquosSpaBookingApp.times=new TmsmAquosSpaBookingApp.TimesCollection,TmsmAquosSpaBookingApp.times.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.timesList=new TmsmAquosSpaBookingApp.TimesListView({collection:TmsmAquosSpaBookingApp.times}),TmsmAquosSpaBookingApp.timesList.render(),TmsmAquosSpaBookingApp.weekdays=new TmsmAquosSpaBookingApp.WeekDayCollection,TmsmAquosSpaBookingApp.weekdays.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.weekdaysList=new TmsmAquosSpaBookingApp.WeekDayListView({collection:TmsmAquosSpaBookingApp.weekdays}),TmsmAquosSpaBookingApp.weekdaysList.render(),TmsmAquosSpaBookingApp.selectedData=new TmsmAquosSpaBookingApp.SelectedDataModel,TmsmAquosSpaBookingApp.selectedDataList=new TmsmAquosSpaBookingApp.SelectedDataView({model:TmsmAquosSpaBookingApp.selectedData})},$(document).ready(function(){0<$("#tmsm-aquos-spa-booking-form").length&&TmsmAquosSpaBookingApp.init()})}(jQuery),document.addEventListener("om.Scripts.init",function(evt){window._omapp.scripts.moment.status="loaded",window._omapp.scripts.moment.object=window.moment||null,window._omapp.scripts.momentTz.status="loaded",window._omapp.scripts.momentTz.object=window.moment?window.moment.tz:null});