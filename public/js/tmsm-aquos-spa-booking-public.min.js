var TmsmAquosSpaBookingApp=TmsmAquosSpaBookingApp||{};!function(m){"use strict";var e={url:TmsmAquosSpaBookingApp.ajaxurl,action:"tmsm-aquos-spa-booking-product-categories",sync:function(e,t,o){return void 0===o.data&&(o.data={}),o.data.nonce=TmsmAquosSpaBookingApp.nonce,o.data.action_type=e,void 0===o.data.action&&void 0!==this.action&&(o.data.action=this.action),Backbone.sync(e,t,o)}},t=Backbone.Model.extend(_.defaults({},e)),e=Backbone.Collection.extend(_.defaults({},e));TmsmAquosSpaBookingApp.HavevoucherModel=Backbone.Model.extend({defaults:{name:null,slug:null,value:null}}),TmsmAquosSpaBookingApp.HavevoucherCollection=Backbone.Collection.extend({model:TmsmAquosSpaBookingApp.HavevoucherModel}),TmsmAquosSpaBookingApp.HavevoucherListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-voucher-container",selectedValue:null,initialize:function(){console.log("HavevoucherListView initialize"),this.listenTo(this.collection,"sync",this.render),this.render()},render:function(){console.log("HavevoucherListView render");var t=m("ul#tmsm-aquos-spa-booking-voucher-list").empty(),e=new TmsmAquosSpaBookingApp.HavevoucherCollection;return e.add([TmsmAquosSpaBookingApp.data.havevoucher.yes,TmsmAquosSpaBookingApp.data.havevoucher.no]),e.each(function(e){e=new TmsmAquosSpaBookingApp.HavevoucherListItemView({model:e});t.append(e.render().$el)},this),this},reset:function(e){this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.selectedValue=null},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.HavevoucherListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-havevoucher-item",template:wp.template("tmsm-aquos-spa-booking-havevoucher"),initialize:function(){this.selectedValue=null,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},select:function(e){TmsmAquosSpaBookingApp.havevoucherList.selectedValue=m(e.target).val(),TmsmAquosSpaBookingApp.messageForPriceAugmentation(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("is_voucher",TmsmAquosSpaBookingApp.havevoucherList.selectedValue),TmsmAquosSpaBookingApp.productsList.loading(),TmsmAquosSpaBookingApp.products.fetch({data:{is_voucher:TmsmAquosSpaBookingApp.havevoucherList.selectedValue}}),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productsList.element()),m("#tmsm-aquos-spa-booking-cancel").show()}}),TmsmAquosSpaBookingApp.ProductCategoryModel=t.extend({action:"tmsm-aquos-spa-booking-product-categories",defaults:{name:null,parent:null,count:null,term_id:null}}),TmsmAquosSpaBookingApp.ProductCategoriesCollection=e.extend({action:"tmsm-aquos-spa-booking-product-categories",model:TmsmAquosSpaBookingApp.ProductCategoryModel}),TmsmAquosSpaBookingApp.ProductCategoriesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-categories-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-categories-select",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var t=this.$(this.selectElement).empty().val("");return"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this.collection.each(function(e){e=new TmsmAquosSpaBookingApp.ProductCategoriesListItemView({model:e});t.append(e.render().$el)},this),"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this},change:function(e){TmsmAquosSpaBookingApp.productsList.loading(),this.selectedValue=m(e.target).val(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.products.fetch({data:{productcategory:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("productcategory",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productsList.element())},reset:function(){this.$(this.selectElement).val("").selectpicker("refresh"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productcategory",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductCategoriesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("term_id")}},className:"tmsm-aquos-spa-booking-product-category-option",template:wp.template("tmsm-aquos-spa-booking-product-category"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},change:function(){}}),TmsmAquosSpaBookingApp.ProductModel=t.extend({action:"tmsm-aquos-spa-booking-products",defaults:{id:null,permalink:null,name:null,thumbnail:null,variable:null,attrotherthan_voucher:null,voucher_variation_id:null,choices:null,is_voucher:null,price:null,category:null}}),TmsmAquosSpaBookingApp.ProductsCollection=e.extend({action:"tmsm-aquos-spa-booking-products",model:TmsmAquosSpaBookingApp.ProductModel}),TmsmAquosSpaBookingApp.ProductsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-products-container",selectedValue:null,selectedIsVariable:null,selectedHasChoicesVariable:null,selectElement:"#tmsm-aquos-spa-booking-products-select",loadingElement:"#tmsm-aquos-spa-booking-products-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-products-select]",initialize:function(){this.hide(),console.log("ProductsListView initialize"),m(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){m(this.loadingElement).show(),m(this.buttonElement).hide(),m(this.selectElement).hide()},loaded:function(){m(this.loadingElement).hide(),m(this.buttonElement).show(),m(this.selectElement).show()},render:function(){var e,o=this.$(this.selectElement).empty().val(""),s=(o.hide(),"function"==typeof o.selectpicker&&(m.fn.selectpicker.Constructor.DEFAULTS.liveSearchPlaceholder=TmsmAquosSpaBookingApp.strings.livesearchplaceholder,o.selectpicker("refresh")),[]);return this.collection.each(function(e){e.attributes.category&&!s[e.attributes.category]&&(s[e.attributes.category]=m("<optgroup>",{label:e.attributes.category}),o.append(s[e.attributes.category])),e.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;var t=new TmsmAquosSpaBookingApp.ProductsListItemView({model:e});s[e.attributes.category]&&s[e.attributes.category].append(t.render().$el)},this),m.each(s,function(e,t){o.append(s[e])}),"function"==typeof o.selectpicker&&(console.log("ProductsListView selectpicker refresh"),o.selectpicker("refresh"),null!=TmsmAquosSpaBookingApp.havevoucherList.selectedValue)&&""!=TmsmAquosSpaBookingApp.productIdFromUrl&&(console.log("Doing product preselection"),0<(e=m("#tmsm-aquos-spa-booking-products-select option[data-parent_id="+TmsmAquosSpaBookingApp.productIdFromUrl+"]")).length?(console.log("found parent "+e.val()),TmsmAquosSpaBookingApp.productIdFromUrl=e.val()):0<(e=m("#tmsm-aquos-spa-booking-products-select option[value="+TmsmAquosSpaBookingApp.productIdFromUrl+"]")).length?console.log("found value "+e.val()):(console.log("did not found value"),TmsmAquosSpaBookingApp.productIdFromUrl=null),console.log("TmsmAquosSpaBookingApp.productIdFromUrl:"+TmsmAquosSpaBookingApp.productIdFromUrl),m("#tmsm-aquos-spa-booking-products-select").val(TmsmAquosSpaBookingApp.productIdFromUrl).trigger("change")),this.loaded(),null!=TmsmAquosSpaBookingApp.havevoucherList.selectedValue&&""!=TmsmAquosSpaBookingApp.productIdFromUrl&&m("#tmsm-aquos-spa-booking-products-select").val(TmsmAquosSpaBookingApp.productIdFromUrl),this},change:function(e){console.log("ProductListView change"),this.selectedValue=m(e.target).val(),m(e.target).find("option[value="+this.selectedValue+"]").prop("selected",!0),console.log(m(e.target).find("option[value="+this.selectedValue+"]")),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.loading(),console.log("selectedValue: "+this.selectedValue),console.log(m(e.target)),this.selectedIsVariable=m(e.target).find("option:selected").attr("data-variable"),this.selectedHasAttributesOtherthanVoucher=m(e.target).find("option:selected").attr("data-attrotherthanvoucher"),this.voucher_variation_id=m(e.target).find("option:selected").attr("data-voucher_variation_id"),console.log("selectedIsVariable: "+this.selectedIsVariable),console.log("selectedHasAttributesOtherthanVoucher: "+this.selectedHasAttributesOtherthanVoucher);e=JSON.parse(m(e.target).find("option:selected").attr("data-choices"));this.selectedHasChoices=0!==e.length,console.warn("selectedChoices: "),TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("selectedHasAttributesOtherthanVoucher",this.selectedHasAttributesOtherthanVoucher),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.choicesList.reset(),TmsmAquosSpaBookingApp.productAttributesList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),this.selectedHasChoices?(console.warn("CASE 1"),TmsmAquosSpaBookingApp.data.choices=e,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.choicesList.element())):this.selectedIsVariable&&this.selectedHasAttributesOtherthanVoucher?(console.warn("CASE 2"),TmsmAquosSpaBookingApp.productvariations.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productattributes.fetch({data:{product:this.selectedValue}}),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productAttributesList.element())):(console.warn("CASE 3"),TmsmAquosSpaBookingApp.selectedData.set("product",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.voucher_variation_id),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),null!==this.voucher_variation_id&&(TmsmAquosSpaBookingApp.selectedData.set("product",null),TmsmAquosSpaBookingApp.selectedData.set("product",this.voucher_variation_id),TmsmAquosSpaBookingApp.selectedData.set("productvariation",null),TmsmAquosSpaBookingApp.selectedData.unset("productvariation"))),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("product",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-parent_id":this.model.get("parent_id"),"data-subtext":this.model.get("sku"),"data-category":this.model.get("category"),"data-variable":this.model.get("variable"),"data-attrotherthanvoucher":this.model.get("attrotherthanvoucher"),"data-voucher_variation_id":this.model.get("voucher_variation_id"),"data-choices":this.model.get("choices")}},className:"tmsm-aquos-spa-booking-product-option",template:wp.template("tmsm-aquos-spa-booking-product"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.AttributeModel=t.extend({action:"tmsm-aquos-spa-booking-attributes",defaults:{label:null,description:null,is_voucher:null}}),TmsmAquosSpaBookingApp.AttributesCollection=e.extend({action:"tmsm-aquos-spa-booking-attributes",model:TmsmAquosSpaBookingApp.AttributeModel}),TmsmAquosSpaBookingApp.AttributesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,loadingElement:"#tmsm-aquos-spa-booking-attributes-loading",cancelElement:"#tmsm-aquos-spa-booking-attributes-cancel",confirmElement:"#tmsm-aquos-spa-booking-attributes-confirm",emptyElement:"#tmsm-aquos-spa-booking-attributes-empty",listElement:"#tmsm-aquos-spa-booking-attributes-list",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click #tmsm-aquos-spa-booking-attributes-cancel":"cancel","click #tmsm-aquos-spa-booking-attributes-confirm":"confirm"},loading:function(){m(this.emptyElement).hide(),m(this.loadingElement).show(),m(this.cancelElement).hide(),m(this.confirmElement).hide(),m(this.listElement).hide()},loaded:function(){m(this.loadingElement).hide(),m(this.cancelElement).show(),m(this.confirmElement).show(),m(this.listElement).show(),void 0!==TmsmAquosSpaBookingApp.productVariationsList&&(TmsmAquosSpaBookingApp.productVariationsList.matchattributes()?m(this.emptyElement):(m(this.emptyElement).show(),m(this.cancelElement).hide(),m(this.confirmElement).hide(),m(this.listElement))).hide()},render:function(){m(this.loadingElement).show();var t=this.$(this.listElement).empty();return this.collection.each(function(e){e.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;e=new TmsmAquosSpaBookingApp.AttributesListItemView({model:e});t.append(e.render().$el)},this),this.loaded(),this},cancel:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null},reset:function(e){TmsmAquosSpaBookingApp.courseParticipants=0,this.$("input").attr("checked",!1).removeAttr("checked").prop("checked",!1),this.$("input.checked-default").attr("checked",!0).prop("checked",!0),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),this.selectedValue=null,this.hide()},confirm:function(e){TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render()},checkattributes:function(){var o,e=m(".tmsm-aquos-spa-booking-attribute"),s=(m(".tmsm-aquos-spa-booking-term"),{}),i=0,a=0;return e.length,0!=TmsmAquosSpaBookingApp.productVariationsList.variationsCount&&(e.each(function(){var e=m(this).find("input[type=radio]"),t=e.data("attribute_name")||e.attr("name"),e=e.filter(":checked").val()||"";0<e.length&&a++,i++,s[t]=e}),o={count:i,chosenCount:a,data:s}.data,e.each(function(e,t){t=m(t).find("input[type=radio]"),t=t.data("attribute_name")||t.attr("name");m.extend(!0,{},o)[t]=""}),o)},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.AttributesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-attribute",template:wp.template("tmsm-aquos-spa-booking-product-attribute"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},events:{"click input":"select"},select:function(e){TmsmAquosSpaBookingApp.courseParticipants=0,m.inArray(m(e.target).val(),["avec-parcours-aquatonic","pa1","avec-parcours-aquatonic-1-personne"])&&(TmsmAquosSpaBookingApp.courseParticipants=1),m.inArray(m(e.target).val(),["pa2","avec-parcours-aquatonic-2-personnes"])&&(TmsmAquosSpaBookingApp.courseParticipants=2),console.info(" TmsmAquosSpaBookingApp.courseParticipants: "+TmsmAquosSpaBookingApp.courseParticipants),TmsmAquosSpaBookingApp.selectedData.set("course_participants",TmsmAquosSpaBookingApp.courseParticipants),TmsmAquosSpaBookingApp.productVariationsList.matchattributes()},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.ProductVariationModel=t.extend({action:"tmsm-aquos-spa-booking-variations",defaults:{id:null,permalink:null,name:null,thumbnail:null,sku:null,attributes:null,price:null,is_voucher:null}}),TmsmAquosSpaBookingApp.ProductVariationsCollection=e.extend({action:"tmsm-aquos-spa-booking-variations",model:TmsmAquosSpaBookingApp.ProductVariationModel}),TmsmAquosSpaBookingApp.ProductVariationsListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-attributes-container",selectedValue:null,selectElement:"#tmsm-aquos-spa-booking-variations-select",variationsCount:0,buttonElement:"[data-id=tmsm-aquos-spa-booking-variations-select]",initialize:function(){m(this.emptyElement).hide(),m(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},render:function(){var t=this.$(this.selectElement).empty().val("");return t.hide(),"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this.collection.each(function(e){e.attributes.is_voucher=TmsmAquosSpaBookingApp.havevoucherList.selectedValue;e=new TmsmAquosSpaBookingApp.ProductVariationsListItemView({model:e});t.append(e.render().$el)},this),"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this.variationsCount=this.collection.length,TmsmAquosSpaBookingApp.productAttributesList.loading(),TmsmAquosSpaBookingApp.productAttributesList.render(),this},change:function(e){this.selectedValue=m(e.target).val(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.selectedData.set("productvariation",this.selectedValue)},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("productvariation",null),TmsmAquosSpaBookingApp.selectedData.unset("productvariation"),this.hide()},matchattributes:function(){var e=TmsmAquosSpaBookingApp.productAttributesList.checkattributes();if(e){for(var t=this.collection.models,o=0;o<t.length;o++){var s,i,a,n=JSON.parse(t[o].attributes.attributes),p=!0;for(s in n)n.hasOwnProperty(s)&&(i=n[s],a=e[s],void 0!==i)&&void 0!==a&&0!==i.length&&0!==a.length&&i!==a&&(p=!1);!0===p&&m(this.selectElement).selectpicker("val",t[o].id).trigger("change")}return t}return!1},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ProductVariationsListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("id"),"data-sku":this.model.get("sku"),"data-attributes":this.model.get("attributes")}},className:"tmsm-aquos-spa-booking-variation-option",template:wp.template("tmsm-aquos-spa-booking-variation"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.ChoiceModel=t.extend({action:"tmsm-aquos-spa-booking-choices",defaults:{aquos_id:null,name:null}}),TmsmAquosSpaBookingApp.ChoicesCollection=e.extend({action:"tmsm-aquos-spa-booking-choices",model:TmsmAquosSpaBookingApp.ChoiceModel}),TmsmAquosSpaBookingApp.ChoicesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-choices-container",selectedValue:null,selectedIsVariable:null,selectedHasAttributesOtherthanVoucher:null,selectElement:"#tmsm-aquos-spa-booking-choices-select",loadingElement:"#tmsm-aquos-spa-booking-choices-loading",buttonElement:"[data-id=tmsm-aquos-spa-booking-choices-select]",initialize:function(){this.hide(),m(this.selectElement).empty().val(""),this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){m(this.loadingElement).show(),m(this.buttonElement).hide(),m(this.selectElement).hide()},loaded:function(){m(this.loadingElement).hide(),m(this.buttonElement).show(),m(this.selectElement).show()},render:function(){var t=this.$(this.selectElement).empty().val("");return t.hide(),"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this.collection.each(function(e){e=new TmsmAquosSpaBookingApp.ChoicesListItemView({model:e});t.append(e.render().$el)},this),"function"==typeof t.selectpicker&&t.selectpicker("refresh"),this.loaded(),this},change:function(e){console.log("ChoicesListView change"),this.selectedValue=m(e.target).val(),console.log("selectedValue: "+this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("choice",this.selectedValue),console.log("TmsmAquosSpaBookingApp.selectedData.get('selectedHasAttributesOtherthanVoucher'):"+TmsmAquosSpaBookingApp.selectedData.get("selectedHasAttributesOtherthanVoucher")),console.log("this.selectedHasAttributesOtherthanVoucher:"+this.selectedHasAttributesOtherthanVoucher),TmsmAquosSpaBookingApp.selectedData.get("selectedHasAttributesOtherthanVoucher")?(console.warn("loading productAttributesList"),TmsmAquosSpaBookingApp.productvariations.fetch({data:{product:TmsmAquosSpaBookingApp.selectedData.get("product")}}),TmsmAquosSpaBookingApp.productattributes.fetch({data:{product:TmsmAquosSpaBookingApp.selectedData.get("product")}}),TmsmAquosSpaBookingApp.productVariationsList.matchattributes(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.productAttributesList.element())):(console.warn("loading dateList"),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element()),"weekdays"==TmsmAquosSpaBookingApp.calendar.dateselection&&TmsmAquosSpaBookingApp.weekdaysList.render())},reset:function(){this.$(this.selectElement).empty().val(""),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("choice",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.ChoicesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return{value:this.model.get("aquos_id"),"data-aquosid":this.model.get("aquos_id")}},className:"tmsm-aquos-spa-booking-choice-option",template:wp.template("tmsm-aquos-spa-booking-choice"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.animateTransition=function(e){e.show(),m("html, body").animate({scrollTop:e.offset().top},400)},TmsmAquosSpaBookingApp.DateListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",selectedValue:null,datePicker:null,initialize:function(){this.hide(),this.render()},selectDate:function(e){console.warn("DateListView selectDate"),this.selectedValue=e.format("yyyy-mm-dd");m("#tmsm-aquos-spa-booking-date-display").html(e.date.toLocaleDateString(TmsmAquosSpaBookingApp.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),TmsmAquosSpaBookingApp.timesList.loading(),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:this.selectedValue}}),TmsmAquosSpaBookingApp.selectedData.set("date",this.selectedValue),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.timesList.element())},events:{},render:function(){return this.datePicker=m("#tmsm-aquos-spa-booking-datepicker").datepicker({language:TmsmAquosSpaBookingApp.locale,format:"yyyy-mm-dd",startDate:TmsmAquosSpaBookingApp.calendar.startdate,endDate:TmsmAquosSpaBookingApp.calendar.enddate}).on("changeDate",this.selectDate),this},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("date",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimeModel=t.extend({action:"tmsm-aquos-spa-booking-times",defaults:{date:null,hour:null,minute:null,priority:null,hourminutes:null}}),TmsmAquosSpaBookingApp.TimesCollection=e.extend({action:"tmsm-aquos-spa-booking-times",model:TmsmAquosSpaBookingApp.TimeModel}),TmsmAquosSpaBookingApp.TimesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-times-container",selectedValue:null,listElement:"#tmsm-aquos-spa-booking-times-list",loadingElement:"#tmsm-aquos-spa-booking-times-loading",errorElement:"#tmsm-aquos-spa-booking-times-error",anotherDateElement:"#tmsm-aquos-spa-booking-times-anotherdate",selectButtons:".tmsm-aquos-spa-booking-time-button",cancelButtons:".tmsm-aquos-spa-booking-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click .tmsm-aquos-spa-booking-time-change-label":"cancelTime","click #tmsm-aquos-spa-booking-times-anotherdate":"changeDate","click .previous":"previous","click .next":"next"},loading:function(){m(this.errorElement).hide(),m(this.loadingElement).show(),m(this.listElement).hide()},loaded:function(){m(this.loadingElement).hide(),m(this.listElement).show()},render:function(){var o=this.$(this.listElement).empty().val(""),s=(o.hide(),0);return this.collection.each(function(e){1===++s&&m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+e.attributes.date+'"]').empty();var t=new TmsmAquosSpaBookingApp.TimesListItemView({model:e});0<m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+e.attributes.date+'"]').length&&m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+e.attributes.date+'"]').append(t.render().el.outerHTML),o.append(t.render().$el)},this),this.loaded(),0===this.collection.length?m(this.errorElement).show():m(this.errorElement).hide(),this},selectTime:function(e){e.preventDefault(),this.selectedValue=m(e.target).data("hourminutes"),m(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),m(e.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquos-spa-booking-time").addClass("disabled"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue)},cancelTime:function(e){e.preventDefault(),m(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null)},changeDate:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset(),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.dateList.element())},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.TimesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-time-item",template:wp.template("tmsm-aquos-spa-booking-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.WeekDayModel=t.extend({action:"tmsm-aquos-spa-booking-weekday",defaults:{date_label:null,date_computed:null}}),TmsmAquosSpaBookingApp.WeekDayCollection=e.extend({action:"tmsm-aquos-spa-booking-weekday",model:TmsmAquosSpaBookingApp.WeekDayModel}),TmsmAquosSpaBookingApp.WeekDayListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-date-container",listElement:"#tmsm-aquos-spa-booking-weekdays-list",selectButtons:".tmsm-aquos-spa-booking-time-button",addAppointmentButton:"#tmsm-aquos-spa-booking-confirm",daysPage:1,templateHelpers:{moment:TmsmAquosSpaBookingApp.moment},initialize:function(){moment.locale(TmsmAquosSpaBookingApp.locale),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-time-button":"selectTime","click #tmsm-aquos-spa-booking-weekdays-previous":"previous","click #tmsm-aquos-spa-booking-weekdays-next":"next"},element:function(){return this.$el},previous:function(e){e.preventDefault(),this.daysPage=this.daysPage-1,this.render()},next:function(e){e.preventDefault(),this.daysPage=this.daysPage+1,this.render()},render:function(){var o=this.daysPage,s=this.$(this.listElement).empty().val(""),e=(this.collection.reset(),m("#tmsm-aquos-spa-booking-weekdays-previous").attr("disabled",!0),m("#tmsm-aquos-spa-booking-weekdays-next").attr("disabled",!0),0);if(TmsmAquosSpaBookingApp.productsList.selectedValue){for(var i=1,e=parseInt(TmsmAquosSpaBookingApp.calendar.daysrangefrom)+7*(this.daysPage-1);e<parseInt(TmsmAquosSpaBookingApp.calendar.daysrangefrom)+7+7*(this.daysPage-1);e++)this.collection.push({date_label:moment().add(e,"days").format("dddd Do MMMM"),date_label_secondline:moment().add(e,"days").format("MMMM"),date_label_firstline:moment().add(e,"days").format("dddd Do"),date_computed:moment().add(e,"days").format("YYYY-MM-DD")});this.collection.each(function(t){var e=new TmsmAquosSpaBookingApp.WeekDayListItemView({model:t});s.append(e.render().$el),m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+t.attributes.date_computed+'"]').next().show(),TmsmAquosSpaBookingApp.times.fetch({data:{productcategory:TmsmAquosSpaBookingApp.productCategoriesList.selectedValue,product:TmsmAquosSpaBookingApp.productsList.selectedValue,productvariation:TmsmAquosSpaBookingApp.productVariationsList.selectedValue,choice:TmsmAquosSpaBookingApp.choicesList.selectedValue,date:t.attributes.date_computed},complete:function(e){console.log("complete fetch"),console.log('hide: .tmsm-aquos-spa-booking-weekday-times[data-date="'+t.attributes.date_computed+'"]'),m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+t.attributes.date_computed+'"]').next().hide(),console.log(m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+t.attributes.date_computed+'"]').next()),7==++i&&(m("#tmsm-aquos-spa-booking-weekdays-previous").attr("disabled",1===o),m("#tmsm-aquos-spa-booking-weekdays-next").attr("disabled",TmsmAquosSpaBookingApp.data.daysrangeto/7<o))}})},this)}return this},selectTime:function(e){e.preventDefault(),this.selectedValue=m(e.target).data("hourminutes");var t=m(e.target).data("date");m(this.selectButtons).removeClass("btn-primary").removeClass("disabled").removeClass("selected").addClass("not-selected"),m(e.target).addClass("btn-primary").addClass("disabled").removeClass("not-selected"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue),TmsmAquosSpaBookingApp.selectedData.set("date",t),0<TmsmAquosSpaBookingApp.selectedData.get("course_participants")&&TmsmAquosSpaBookingApp.courseplugin?TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.courseTimesList.element()):TmsmAquosSpaBookingApp.animateTransition(m(this.addAppointmentButton))}}),TmsmAquosSpaBookingApp.WeekDayListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-weekday-item",template:wp.template("tmsm-aquos-spa-booking-weekday"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.CourseTimeModel=t.extend({action:"tmsm-aquos-spa-booking-course-times",defaults:{date:null,hour:null,minute:null,priority:null,hourminutes:null}}),TmsmAquosSpaBookingApp.CourseTimesCollection=e.extend({action:"tmsm-aquos-spa-booking-course-times",model:TmsmAquosSpaBookingApp.CourseTimeModel}),TmsmAquosSpaBookingApp.CourseTimesListView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-course-times-container",selectedValue:null,listElement:"#tmsm-aquos-spa-booking-course-times-list",loadingElement:"#tmsm-aquos-spa-booking-course-times-loading",errorElement:"#tmsm-aquos-spa-booking-course-times-error",anotherDateElement:"#tmsm-aquos-spa-booking-course-times-anotherdate",selectButtons:".tmsm-aquos-spa-booking-course-time-button",cancelButtons:".tmsm-aquos-spa-booking-course-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquos-spa-booking-course-time-button":"selectTime","click .tmsm-aquos-spa-booking-course-time-change-label":"cancelTime","click .previous":"previous","click .next":"next"},loading:function(){m(this.errorElement).hide(),m(this.loadingElement).show(),m(this.listElement).hide()},loaded:function(){m(this.loadingElement).hide(),m(this.listElement).show()},render:function(){var t=this.$(this.listElement).empty().val(""),o=(t.hide(),0);return this.collection.each(function(e){1===++o&&m('.tmsm-aquos-spa-booking-weekday-times[data-date="'+e.attributes.date+'"]').empty();e=new TmsmAquosSpaBookingApp.TimesListItemView({model:e});t.append(e.render().$el)},this),this.loaded(),0===this.collection.length?m(this.errorElement).show():m(this.errorElement).hide(),this},selectTime:function(e){e.preventDefault(),this.selectedValue=m(e.target).data("hourminutes"),m(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),m(e.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquos-spa-booking-course-time").addClass("disabled"),TmsmAquosSpaBookingApp.selectedData.set("hourminutes",this.selectedValue)},cancelTime:function(e){e.preventDefault(),m(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null)},changeDate:function(e){e.preventDefault(),TmsmAquosSpaBookingApp.courseTimesList.reset()},reset:function(){this.selectedValue=null,TmsmAquosSpaBookingApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.CourseTimesListItemView=Backbone.View.extend({tagName:"li",className:"tmsm-aquos-spa-booking-course-time-item",template:wp.template("tmsm-aquos-spa-booking-course-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this}}),TmsmAquosSpaBookingApp.SelectedDataModel=Backbone.Model.extend({defaults:{productcategory:null,product:null,productvariation:null,date:null,hourminutes:null,course_participants:null,course_hourminutes:null,is_voucher:null}}),TmsmAquosSpaBookingApp.SelectedDataView=Backbone.View.extend({el:"#tmsm-aquos-spa-booking-confirm-container",cancelButton:"#tmsm-aquos-spa-booking-cancel",confirmButton:"#tmsm-aquos-spa-booking-confirm",errorElement:"#tmsm-aquos-spa-booking-confirm-error",initialize:function(){this.hideError(),this.hideConfirm(),this.hideCancel(),this.listenTo(this.model,"change",this.change)},events:{"click #tmsm-aquos-spa-booking-cancel":"cancel","click #tmsm-aquos-spa-booking-confirm":"confirm"},cancel:function(e){e.preventDefault(),this.hideError(),TmsmAquosSpaBookingApp.selectedData.clear().set({}),TmsmAquosSpaBookingApp.animateTransition(TmsmAquosSpaBookingApp.havevoucherList.element()),TmsmAquosSpaBookingApp.havevoucherList.reset(),TmsmAquosSpaBookingApp.productCategoriesList.reset(),TmsmAquosSpaBookingApp.productsList.reset(),TmsmAquosSpaBookingApp.productVariationsList.reset(),TmsmAquosSpaBookingApp.dateList.reset(),TmsmAquosSpaBookingApp.timesList.reset()},confirm:function(e){e.preventDefault(),console.log("SelectedDataView confirm"),m(this.errorElement).empty(),this.showLoading();var t=this;wp.ajax.send("tmsm-aquos-spa-booking-addtocart",{success:function(e){e.redirect?window.location=e.redirect:(console.log("no redirect..."),console.log(e.redirect))},error:function(e){e.errors&&(t.showError(),m(t.errorElement).html(e.errors))},data:{nonce:TmsmAquosSpaBookingApp.nonce,selecteddata:TmsmAquosSpaBookingApp.selectedData.attributes}})},change:function(){console.log("SelectedDataView change"),this.canConfirm(this.model.attributes)?this.showConfirm():this.hideConfirm(),this.canCancel(this.model.attributes)?this.showCancel():this.hideCancel()},showLoading:function(){m(this.confirmButton).prop("disabled",!0).addClass("btn-disabled")},hideLoading:function(){m(this.confirmButton).prop("disabled",!1).removeClass("btn-disabled")},showError:function(){m(this.errorElement).show()},hideError:function(){m(this.errorElement).hide()},showConfirm:function(){m(this.confirmButton).show()},hideConfirm:function(){m(this.confirmButton).hide()},showCancel:function(){m(this.cancelButton).show()},hideCancel:function(){m(this.cancelButton).hide()},canConfirm:function(e){return null!=e.productcategory&&null!=e.product&&null!=e.date&&null!=e.hourminutes},canCancel:function(e){return null!=e.is_voucher&&null!=e.productcategory},render:function(){return this},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquosSpaBookingApp.messageForPriceAugmentation=function(){var e=TmsmAquosSpaBookingApp.calendar.daysrangeto,t=TmsmAquosSpaBookingApp.calendar.messagedate,o=m(event.target).val(),s=new Date,t=(t=t,(t=new Date(t)).setDate(t.getDate()+1),Math.floor((t-s)/864e5));console.log(t),t<=e&&0<=t&&(0==o?m(".tmsm-message").show():m(".tmsm-message").hide())},TmsmAquosSpaBookingApp.init=function(){TmsmAquosSpaBookingApp.productIdFromUrl=window.location.hash.split("#").pop(),TmsmAquosSpaBookingApp.courseParticipants=0,TmsmAquosSpaBookingApp.havevoucherList=new TmsmAquosSpaBookingApp.HavevoucherListView,TmsmAquosSpaBookingApp.productcategories=new TmsmAquosSpaBookingApp.ProductCategoriesCollection,TmsmAquosSpaBookingApp.productcategories.reset(TmsmAquosSpaBookingApp.data.productcategories),TmsmAquosSpaBookingApp.productCategoriesList=new TmsmAquosSpaBookingApp.ProductCategoriesListView({collection:TmsmAquosSpaBookingApp.productcategories}),TmsmAquosSpaBookingApp.productCategoriesList.render(),TmsmAquosSpaBookingApp.productattributes=new TmsmAquosSpaBookingApp.AttributesCollection,TmsmAquosSpaBookingApp.productattributes.reset(TmsmAquosSpaBookingApp.data.productattributes),TmsmAquosSpaBookingApp.productAttributesList=new TmsmAquosSpaBookingApp.AttributesListView({collection:TmsmAquosSpaBookingApp.productattributes}),TmsmAquosSpaBookingApp.productAttributesList.render(),TmsmAquosSpaBookingApp.products=new TmsmAquosSpaBookingApp.ProductsCollection,TmsmAquosSpaBookingApp.products.reset(TmsmAquosSpaBookingApp.data.products),TmsmAquosSpaBookingApp.productsList=new TmsmAquosSpaBookingApp.ProductsListView({collection:TmsmAquosSpaBookingApp.products}),TmsmAquosSpaBookingApp.productsList.render(),TmsmAquosSpaBookingApp.productvariations=new TmsmAquosSpaBookingApp.ProductVariationsCollection,TmsmAquosSpaBookingApp.productvariations.reset(TmsmAquosSpaBookingApp.data.productvariations),TmsmAquosSpaBookingApp.productVariationsList=new TmsmAquosSpaBookingApp.ProductVariationsListView({collection:TmsmAquosSpaBookingApp.productvariations}),TmsmAquosSpaBookingApp.productVariationsList.render(),TmsmAquosSpaBookingApp.choices=new TmsmAquosSpaBookingApp.ChoicesCollection,TmsmAquosSpaBookingApp.choices.reset(TmsmAquosSpaBookingApp.data.choices),TmsmAquosSpaBookingApp.choicesList=new TmsmAquosSpaBookingApp.ChoicesListView({collection:TmsmAquosSpaBookingApp.choices}),TmsmAquosSpaBookingApp.choicesList.render(),TmsmAquosSpaBookingApp.dateList=new TmsmAquosSpaBookingApp.DateListView,TmsmAquosSpaBookingApp.times=new TmsmAquosSpaBookingApp.TimesCollection,TmsmAquosSpaBookingApp.times.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.timesList=new TmsmAquosSpaBookingApp.TimesListView({collection:TmsmAquosSpaBookingApp.times}),TmsmAquosSpaBookingApp.timesList.render(),TmsmAquosSpaBookingApp.weekdays=new TmsmAquosSpaBookingApp.WeekDayCollection,TmsmAquosSpaBookingApp.weekdays.reset(TmsmAquosSpaBookingApp.data.times),TmsmAquosSpaBookingApp.weekdaysList=new TmsmAquosSpaBookingApp.WeekDayListView({collection:TmsmAquosSpaBookingApp.weekdays}),TmsmAquosSpaBookingApp.weekdaysList.render(),TmsmAquosSpaBookingApp.coursetimes=new TmsmAquosSpaBookingApp.CourseTimesCollection,TmsmAquosSpaBookingApp.coursetimes.reset(TmsmAquosSpaBookingApp.data.coursetimes),TmsmAquosSpaBookingApp.courseTimesList=new TmsmAquosSpaBookingApp.CourseTimesListView({collection:TmsmAquosSpaBookingApp.coursetimes}),TmsmAquosSpaBookingApp.courseTimesList.render(),TmsmAquosSpaBookingApp.selectedData=new TmsmAquosSpaBookingApp.SelectedDataModel,TmsmAquosSpaBookingApp.selectedDataList=new TmsmAquosSpaBookingApp.SelectedDataView({model:TmsmAquosSpaBookingApp.selectedData})},m(document).ready(function(){0<m("#tmsm-aquos-spa-booking-form").length&&TmsmAquosSpaBookingApp.init()})}(jQuery),document.addEventListener("om.Scripts.init",function(e){window._omapp.scripts.moment.status="loaded",window._omapp.scripts.moment.object=window.moment||null,window._omapp.scripts.momentTz.status="loaded",window._omapp.scripts.momentTz.object=window.moment?window.moment.tz:null});